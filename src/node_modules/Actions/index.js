import { 
	START, 
	SUCCESS, 
	FAILURE,
	LOAD_PRODUCTS,
	ADD_CART,
	DELETE_CART,
	SEARCH,
	FILTER_BRANDS,
	LOAD_PRODUCT
} from 'constans'

//http://www.mocky.io/v2/5ad35ab32d000054005c97c9

export function loadProduct(id){
	const linkMocky = {
		id1: 'http://www.mocky.io/v2/5ad4a9d62e00002a00583c1b?mocky-delay=1500ms',
		id2: 'http://www.mocky.io/v2/5ad4d4fe3200005000202957?mocky-delay=1500ms',
		id3: 'http://www.mocky.io/v2/5ad4d53f3200005d0020295b?mocky-delay=1500ms',
		id4: 'http://www.mocky.io/v2/5ad4d57e3200006b0020295f?mocky-delay=1500ms',
		id5: 'http://www.mocky.io/v2/5ad4d8343200006700202969?mocky-delay=1500ms',
		id6: 'http://www.mocky.io/v2/5acfa9a331000066004eaa50?mocky-delay=1500ms',
	}
	return (dispatch) => {
		dispatch({
			type: LOAD_PRODUCT + START,
			payload: {id}
		})
		const link = linkMocky[id]
		fetch( link )
			.then(res => {
          if (res.status >= 400) {
              throw new Error(res.statusText)
          }
          return res.json()
      })
      .then(res =>{
      	return dispatch({
          type: LOAD_PRODUCT + SUCCESS,
          payload: {id, res}
      	})}
      )
			.catch( (err) => {
				dispatch({
					type: LOAD_PRODUCT+FAILURE,
					payload: {id}
				})
			})
	}
}

export function loadCatalog(){
	return (dispatch) => {
		dispatch({
			type: LOAD_PRODUCTS+START
		})
		// http://www.mocky.io/v2/5ace4d412e00002f00c2c25a
		fetch('http://www.mocky.io/v2/5acf55573100005f004ea8df?mocky-delay=1000ms')
			.then(res => {
          if (res.status >= 400) {
              throw new Error(res.statusText)
          }
          return res.json()
      })
      .then(res =>{
      	return dispatch({
          type: LOAD_PRODUCTS + SUCCESS,
          payload: res
      	})}
      )
			.catch( (err) => {
				dispatch({
					type: LOAD_PRODUCTS+FAILURE
			})
		})
	}
}

export function addCart(price, productId, offerId){
	return({
		type: ADD_CART,
		payload: {price, productId, offerId}
	})
}

export function deleteCart(id, offerId, price){
	return({
		type: DELETE_CART,
		payload: {id, offerId, price}
	})
}

export function search(search){
	return({
		type: SEARCH,
		payload: search
	})
}

export function filterBrands(checkboxes){
	return({
		type: FILTER_BRANDS,
		payload: checkboxes
	})
}